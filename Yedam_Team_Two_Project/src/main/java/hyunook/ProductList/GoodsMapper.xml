<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hyunook.ProductList.GoodsMapper">
	<select id="privateProductList" resultType="common.Goods" parameterType="hyunook.ProductList.GoodsSearch">
	   <!-- 개인판매자 조회 -->
	   SELECT * 
       FROM (SELECT /*+ INDEX(m SYS_C008499) */
                        ROWNUM rn,
                        GOODS_ID,
                        NAME,
                        DESCRIPTION,
                        PRICE,
                        HASHTAG,
                        VIEW_CNT,
                        IMAGE,
                        GOODS_STATE,
                        REQ_TYPE,
                        REQ_DATE,
                        RESP_DATE,
                        CATEGORY_ID,
                        MEMBER_ID,
                        SCORE_ID
                FROM   goods
                <![CDATA[
                WHERE ROWNUM <= (#{page}*5) )b
                 ]]>  
           <choose>
              <when test = "order == 'popular'">  
                order by 6 desc
              </when>  
               <when test = "order == 'old'">  
                 order by 10 desc
              </when>
              <otherwise>
                 order by 10
             </otherwise>  
        </choose>                   
         WHERE member_id IN (SELECT member_id
                             FROM member
                             WHERE member_type='SELLER')
       AND b.rn >(#{page}-1)*5  
     <if test="category != null and category != ''">
          AND category_id IN(SELECT category_id
                          FROM CATEGORIES
                          WHERE category_id = category_id
                          AND name = #{category} )   
       </if>
       AND price between ${price1} AND ${price2}                 
       AND b.rn > (#{rpage} -1)*5
        
          
                                                                   
                                       
       
	</select>
	
	<select id="goodsList">
		SELECT goods_id,
               name,
               description,
               price,
               req_date,
               member_id
		FROM goods
		ORDER BY req_date DESC  
	</select>
	
	<select id="selectGoods" parameterType="int" resultType="goods">
		SELECT goods_id,
			   name,
			   description
		FROM goods
		WHERE goods_id = #{goodsId}
	</select>
	
	<insert id="insertGoods" parameterType="common.Goods">
		INSERT INTO goods  (goods_id,
	                        name,
	                        description,
	                        price,
	                        hashtag,
	                        view_cnt,
	                        image,
	                        goods_state,
	                        req_type,
	                        req_date,
	                        resp_date,
	                        category_id,
	                        member_id,
	                        score_id)
		VALUES (goods_id_seq.NEXTVAL,
                #{name},
                #{description},
                1000,
                '#',
                0,
                #{image},
                'sale',
                'NONE',
                SYSDATE,
                SYSDATE,
                1,
                'userId1',
                1)
	</insert>
	
	<delete id="removeGoods" parameterType="int">
		delete goods where goods_id = #{goodsId}
	</delete>
	
	<update id="updateGoods" parameterType="goods">
		UPDATE goods
		SET    name = #{name},
			   description = #{description}
		WHERE goods_id = #{goodsId}
	</update>
</mapper>